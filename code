<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>簡易計價程式</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
            color: #5a009d; /* 參考圖片的紫色系 */
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="number"], select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box; /* 確保 padding 不會影響寬度 */
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .package-options {
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .package-options label {
            font-weight: normal;
            display: inline-block;
            margin-right: 15px;
        }
        button {
            width: 100%;
            padding: 12px;
            background-color: #5a009d;
            color: white;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #4a0080;
        }
        #results {
            margin-top: 20px;
            padding: 15px;
            background-color: #fdfdfd;
            border: 1px dashed #ccc;
            border-radius: 4px;
        }
        #results h2 {
            margin-top: 0;
        }
        #results p {
            font-size: 1.1em;
            margin: 10px 0;
        }
        #total-price {
            font-size: 1.8em;
            font-weight: bold;
            color: #d90000;
            text-align: center;
        }
        #error-message {
            color: #d90000;
            font-weight: bold;
            text-align: center;
        }
        /* 讓 disabled 狀態更明顯 */
        fieldset[disabled] {
            opacity: 0.5;
            background-color: #eee;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>櫃檯簡易計價程式</h1>

        <div class="form-group">
            <label for="dayType">時段</label>
            <select id="dayType">
                <option value="weekday">平日</option>
                <option value="weekend">假日</option>
            </select>
        </div>

        <div class="form-group">
            <label for="serviceType">消費項目</label>
            <select id="serviceType">
                <option value="reading">看書</option>
                <option value="internet">上網</option>
            </select>
        </div>

        <div class="form-group">
            <label for="isMember">顧客身份</label>
            <select id="isMember">
                <option value="member">會員</option>
                <option value="non-member">非會員</option>
            </select>
        </div>

        <fieldset id="package-fieldset" class="form-group">
            <legend style="font-weight: bold; margin-bottom: 5px;">包時方案 (會員專用)</legend>
            <div class="package-options">
                <label><input type="checkbox" id="pkg3" value="3"> 3 小時</label>
                <label><input type="checkbox" id="pkg6" value="6"> 6 小時</label>
                <label><input type="checkbox" id="pkg9" value="9"> 9 小時</label>
            </div>
        </fieldset>

        <div class="form-group">
            <label for="totalMinutes">總消費分鐘</label>
            <input type="number" id="totalMinutes" placeholder="請輸入總共停留的分鐘數" min="0">
        </div>

        <button id="calculateButton">計算金額</button>

        <div id="results" style="display: none;">
            <h2>計算結果</h2>
            <p id="error-message"></p>
            <p>基本費用 (包時): <span id="result-base-price"></span> 元</p>
            <p>超時費用: <span id="result-overage-price"></span> 元</p>
            <hr>
            <p style="text-align: center; font-size: 1.2em;">總應收金額</p>
            <p id="total-price"></p>
        </div>
    </div>

    <script>
        // --- 資料庫 (根據您的圖片) ---

        // 會員包時價格
        const packagePrices = {
            weekday: {
                reading: { 3: 210, 6: 360, 9: 450 },
                internet: { 3: 240, 6: 400, 9: 500 }
            },
            weekend: {
                reading: { 3: 240, 6: 420, 9: 540 },
                internet: { 3: 270, 6: 470, 9: 600 }
            }
        };

        // 每分鐘費率
        const perMinuteRates = {
            reading: 1.66,
            internet: 1.83
        };

        // 最低消費
        const minCharges = {
            reading: 100,
            internet: 110
        };

        // --- 核心功能 ---

        // 結帳金額尾數未滿5元以5元計價
        function roundUpTo5(price) {
            // 1. 先無條件捨去小數 (如 263.52 -> 263)
            const flooredPrice = Math.floor(price);
            // 2. 檢查尾數是否為 0 或 5
            const remainder = flooredPrice % 10;
            if (remainder === 0 || remainder === 5) {
                return flooredPrice; // 260, 265
            }
            // 3. 向上取到最接近的 5 或 0
            // Math.ceil(52.6) * 5 = 53 * 5 = 265 (適用 261~265)
            // Math.ceil(53.6) * 5 = 54 * 5 = 270 (適用 266~270)
            return Math.ceil(flooredPrice / 5) * 5;
        }

        // 主計算函數
        function calculatePrice() {
            // 1. 取得所有輸入值
            const dayType = document.getElementById('dayType').value;
            const serviceType = document.getElementById('serviceType').value;
            const isMember = (document.getElementById('isMember').value === 'member');
            const totalMinutes = parseInt(document.getElementById('totalMinutes').value) || 0;

            const pkg3 = document.getElementById('pkg3').checked;
            const pkg6 = document.getElementById('pkg6').checked;
            const pkg9 = document.getElementById('pkg9').checked;

            // 取得對應的費率
            const rate = perMinuteRates[serviceType];
            const minCharge = minCharges[serviceType];
            const prices = packagePrices[dayType][serviceType];

            // 變數初始化
            let basePrice = 0;
            let overagePrice = 0;
            let totalPrice = 0;
            let packageMinutes = 0;
            let errorMessage = "";

            // 2. 邏輯判斷
            if (!isMember) {
                // --- 非會員 ---
                // 非會員不能使用包時
                if (pkg3 || pkg6 || pkg9) {
                    errorMessage = "錯誤：非會員無法選擇包時方案。";
                }
                
                // 以分鐘計價
                const rawPrice = totalMinutes * rate;
                // 比較最低消費
                basePrice = Math.max(rawPrice, minCharge);
                overagePrice = 0; // 非會員沒有超時問題
                totalPrice = basePrice;

            } else {
                // --- 會員 ---
                // 檢查是否選擇包時
                if (pkg3) { basePrice += prices[3]; packageMinutes += 180; }
                if (pkg6) { basePrice += prices[6]; packageMinutes += 360; }
                if (pkg9) { basePrice += prices[9]; packageMinutes += 540; }

                if (packageMinutes > 0) {
                    // --- 2a. 會員有選包時 ---
                    const overageMinutes = Math.max(0, totalMinutes - packageMinutes);
                    
                    if (overageMinutes > 0) {
                        // 根據您的範例，超時費用 *會員打9折*
                        const rawOverage = overageMinutes * rate;
                        const discountedOverage = rawOverage * 0.9;
                        overagePrice = discountedOverage;
                    }
                    totalPrice = basePrice + overagePrice;

                } else {
                    // --- 2b. 會員 (不包時，以分鐘計價) ---
                    // 我們假設會員以分鐘計價，也會有 9 折優惠
                    const rawPrice = totalMinutes * rate;
                    // 先比較最低消費
                    const priceBeforeDiscount = Math.max(rawPrice, minCharge);
                    // 再打折
                    basePrice = priceBeforeDiscount * 0.9;
                    totalPrice = basePrice;
                }
            }

            // 3. 最終結算 (套用 "未滿5元以5元計價" 規則)
            // 您的範例中，是 "超時費用" 單獨進位，
            // 但規則圖說是 "結帳金額"，這通常指 "總金額"。
            // 這裡我採用您範例的邏輯：*超時費用* 和 *包時費用* 分開計算，最後加總。
            // 但更常見的邏輯是 "總金額" 最後才進位。

            // 這裡採用您的範例邏輯：超時費用單獨進位
            const finalBasePrice = roundUpTo5(basePrice);
            const finalOveragePrice = roundUpTo5(overagePrice);
            
            // 總金額是兩者相加 (因為可能 265 + 740 = 1005)
            // 如果是總金額最後才進位，請用下面這行:
            // const finalTotalPrice = roundUpTo5(totalPrice);
            
            // 採用您的範例：超時費 263.52 -> 265。
            // 我們假設包廂費 740 不變。總額 = 740 + 265 = 1005
            
            // 為了簡化，我們將「包時(無折扣)」和「超時(有折扣)」分開顯示
            // 總金額 = (包時金額) + (進位後的超時金額)
            // **修正邏輯**：如果是非會員或會員分鐘計價，basePrice 已經是總價
            
            let displayBase = 0;
            let displayOverage = 0;
            let displayTotal = 0;

            if (!isMember) {
                // 非會員：總價 = 進位後的 basePrice
                displayBase = 0;
                displayOverage = 0;
                displayTotal = roundUpTo5(totalPrice);
            } else if (packageMinutes > 0) {
                // 會員包時：總價 = (包時費) + (進位後的超時費)
                displayBase = basePrice; // 包時費本身是固定的，不需進位
                displayOverage = roundUpTo5(overagePrice);
                displayTotal = displayBase + displayOverage;
            } else {
                // 會員分鐘計價：總價 = 進位後的 totalPrice
                displayBase = 0;
                displayOverage = 0;
                displayTotal = roundUpTo5(totalPrice);
            }


            // 4. 顯示結果
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';

            document.getElementById('error-message').innerText = errorMessage;
            document.getElementById('result-base-price').innerText = displayBase;
            document.getElementById('result-overage-price').innerText = displayOverage;
            document.getElementById('total-price').innerText = displayTotal + " 元";
        }

        // --- 事件監聽 ---
        document.getElementById('calculateButton').addEventListener('click', calculatePrice);

        // 會員身份切換時，控制包時方案是否可選
        document.getElementById('isMember').addEventListener('change', function() {
            const isMember = (this.value === 'member');
            const packageFieldset = document.getElementById('package-fieldset');
            
            packageFieldset.disabled = !isMember;
            
            // 如果切換到非會員，自動取消勾選
            if (!isMember) {
                document.getElementById('pkg3').checked = false;
                document.getElementById('pkg6').checked = false;
                document.getElementById('pkg9').checked = false;
            }
        });

    </script>
</body>
</html>
